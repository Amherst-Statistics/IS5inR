---
title: "IS5 in R: Understanding and Comparing Distributions (Chapter 4)"
author: "Margaret Chien and Nicholas Horton (nhorton@amherst.edu)"
date: "July 13, 2018"
output: 
  pdf_document:
    fig_height: 3
    fig_width: 5
  html_document:
    fig_height: 3
    fig_width: 5
  word_document:
    fig_height: 4
    fig_width: 6
---


```{r, include = FALSE}
# Don't delete this chunk if you are using the mosaic package
# This loads the mosaic and dplyr packages
library(mosaic)
library(readr)
library(janitor)
```

```{r, include = FALSE}
# knitr settings to control how R chunks work.
require(knitr)
opts_chunk$set(
  tidy = FALSE,     # display code as typed
  size = "small"    # slightly smaller font for code
)
```

## Introduction and background 

This document is intended to help describe how to undertake analyses introduced 
as examples in the Fifth Edition of *Intro Stats* (2018) by De Veaux, Velleman, and Bock.
More information about the book can be found at http://wps.aw.com/aw_deveaux_stats_series.  This
file as well as the associated R Markdown reproducible analysis source file used to create it can be found at http://nhorton.people.amherst.edu/is5.

This work leverages initiatives undertaken by Project MOSAIC (http://www.mosaic-web.org), an NSF-funded effort to improve the teaching of statistics, calculus, science and computing in the undergraduate curriculum. In particular, we utilize the `mosaic` package, which was written to simplify the use of R for introductory statistics courses. A short summary of the R needed to teach introductory statistics can be found in the mosaic package vignettes (http://cran.r-project.org/web/packages/mosaic).  A paper describing the mosaic approach was published in the *R Journal*: https://journal.r-project.org/archive/2017/RJ-2017-024.

## Chapter 4: Understanding and Comparing Distributions

```{r}
library(mosaic)
library(readr)
library(janitor)
HopkinsForest <- read_csv("http://nhorton.people.amherst.edu/is5/data/Hopkins_Forest.csv") %>%
  clean_names()
names(HopkinsForest)
```

By default, `read_csv()` prints the variable names. These messages can be suppressed using the `message = FALSE` code chunk option to save space and improve readability.   
Here we use the `clean_names()` function from the `janitor` package to sanitize the names of the columns (which would otherwise contain special characters or whitespace). You can use the `names()` function to check the cleaned names.

```{r}
# Figure 4.1, page 96
gf_histogram(~ avg_wind_mph, data = HopkinsForest, 
             xlab = "Average Wind Speed (mph)", ylab = "# of Days", binwidth = 0.5, center = 0.25)
favstats(~ avg_wind_mph, data = HopkinsForest)
```

### Section 4.1: Displays for Comparing Groups

#### Histograms

```{r}
HopkinsForest <- HopkinsForest %>%
  mutate(catmonth = ifelse(month <= 9 & month >= 4, "Spring/Summer", "Fall/Winter"))
# Figure 4.2, page 96 
gf_histogram(~ avg_wind_mph, data = HopkinsForest, binwidth = 0.5, center = 0.25, 
             xlab = "Average Wind Speed (mph)", y = "# of Days") %>%
  gf_facet_wrap(~ catmonth)
favstats(~ avg_wind_mph | catmonth, data = HopkinsForest)
```

#### Example 4.1: Comparing Groups with Stem-And-Leaf

```{r}
# Figure 4.1, page 97
NestEgg <- read_csv("http://nhorton.people.amherst.edu/is5/data/Nest_Egg_Index.csv") %>%
  clean_names()
with(NestEgg, stem(nest_egg_index))
```

#### Boxplots

As noted in the book, boxplots are most useful to compare distributions. Below, we have replicated the single boxplot from page 98, but we don't recommend the use of single boxplots.

```{r}
# Step 4 on page 98
gf_boxplot(~ avg_wind_mph, data = HopkinsForest, y = "Daily Average Wind Speed (mph)")  # or gf_boxplot(X ~ 1)
```

Instead, we can make comparisons more easily by placing boxplots side by side with the following code: 

```{r}
# Figure 4.3, page 99
gf_boxplot(avg_wind_mph ~ as.factor(month), data = HopkinsForest) %>%
  gf_labs(x = "Month", y = "Average wind speed (mph)")
```

We use the `as.factor()` function to convert a variable into a factor.  


#### Example 4.2: Comparing Groups with Boxplots

```{r}
# Example 4.2, page 99
Coasters <- read_csv("http://nhorton.people.amherst.edu/is5/data/Coasters_2015.csv")
gf_boxplot(Speed ~ Track, data = Coasters)
```

#### Step-By-Step Example: Comparing Groups

```{r}
Cups <- read_csv("http://nhorton.people.amherst.edu/is5/data/Cups.csv")
favstats(~ Difference | Container, data = Cups)
# Step by Step, page 101
gf_boxplot(Difference ~ Container, data = Cups, ylab = "Temp Change in F") 
```

#### Just Checking

```{r, warning=FALSE}
Flights <- read_csv("http://nhorton.people.amherst.edu/is5/data/Flights_on_time_2016.csv") %>%
  clean_names()
# Bureau of Transportation Statistics, page 101
gf_histogram(~ ontime_pct, data = Flights, binwidth = 2, ylab = "# of Months", xlab = "Ontime %", 
             center = 1)
gf_boxplot(~ ontime_pct, data = Flights)
gf_boxplot(ontime_pct ~ month, data = Flights)
```

#### Random Matters

```{r}
# Figure 4.4, page 102
CarSpeeds <- read_csv("http://nhorton.people.amherst.edu/is5/data/Car_speeds.csv")
gf_boxplot(speed ~ direction, data = CarSpeeds)
```

XX MC removed beause we made the same graph earlier

### Section 4.3: Re-Expressing Data: A First Look

#### Re-Expressing to Improve Symmetry

```{r}
CEOComp <- read_csv("http://nhorton.people.amherst.edu/is5/data/CEO_Compensation_2014.csv") %>%
  clean_names()
# Figure 4.6, page 105
gf_histogram(~ ceo_compensation_m, xlab = "Compensation (M$)", ylab = "Millions of $", 
             data = CEOComp, binwidth = 2.5, center = 2.5/2)
gf_boxplot(~ ceo_compensation_m, xlab = "Compensation (M$)", ylab = "Millions of $", 
           data = CEOComp)

# Figure 4.7, page 106
gf_histogram(~ log(ceo_compensation_m), xlab = "Log (compensation)", ylab = "# of CEOs", 
             data = CEOComp, binwidth = .224, center = .112)
```

#### Re-Expression to Equalize Spread Across Groups

```{r}
PassiveSmoke <- read_csv("http://nhorton.people.amherst.edu/is5/data/Passive_smoke.csv")
# Figure 4.8, page 107
gf_boxplot(cotinine ~ smoke_exposure, ylab = "Cotinine (ng/ml)", xlab = "Smoke Exposure", 
           data = PassiveSmoke)
# Figure 4.9, page 107
gf_boxplot(log(cotinine) ~ smoke_exposure, ylab = "Log(cotinine)", xlab = "Smoke Exposure", 
           data = PassiveSmoke)
```
