---
title: "IS5 in R: Relationships Between Categorical Variables--Contingency Tables (Chapter 3)"
author: "Margaret Chien and Nicholas Horton (nhorton@amherst.edu)"
date: "June 10, 2018"
output: 
  pdf_document:
    fig_height: 4
    fig_width: 6
  html_document:
    fig_height: 3
    fig_width: 5
  word_document:
    fig_height: 4
    fig_width: 6
---


```{r, include = FALSE}
# Don't delete this chunk if you are using the mosaic package
# This loads the mosaic and dplyr packages
require(mosaic)
```

```{r, include = FALSE}
# knitr settings to control how R chunks work.
require(knitr)
opts_chunk$set(
  tidy = FALSE,     # display code as typed
  size = "small"    # slightly smaller font for code
)
```

## Introduction and background 

This document is intended to help describe how to undertake analyses introduced 
as examples in the Fifth Edition of *Intro Stats* (2018) by De Veaux, Velleman, and Bock.
More information about the book can be found at http://wps.aw.com/aw_deveaux_stats_series.  This
file as well as the associated R Markdown reproducible analysis source file used to create it can be found at http://nhorton.people.amherst.edu/is5.

This work leverages initiatives undertaken by Project MOSAIC (http://www.mosaic-web.org), an NSF-funded effort to improve the teaching of statistics, calculus, science and computing in the undergraduate curriculum. In particular, we utilize the `mosaic` package, which was written to simplify the use of R for introductory statistics courses. A short summary of the R needed to teach introductory statistics can be found in the mosaic package vignettes (http://cran.r-project.org/web/packages/mosaic).  A paper describing the mosaic approach was published in the *R Journal*: https://journal.r-project.org/archive/2017/RJ-2017-024.

## Chapter 3: Relationships Between Categorical Variables--Contingency Tables

### Section 3.1: Contingency Tables

```{r}
OKCupid <- read_csv("http://nhorton.people.amherst.edu/is5/data/OKCupid_CatsDogs.csv", skip = 1)
# If you look at the data set, you'll see that the first line is "Col1", "Col2", etc
tally(~ CatsDogsBoth + Gender, margin = TRUE, data = OKCupid)
tally(~ CatsDogsBoth + Gender, format = "percent", margin = TRUE, data = OKCupid)
tally(~ CatsDogsBoth | Gender, format = "percent", margin = TRUE, data = OKCupid)
tally(~ Gender | CatsDogsBoth, format = "percent", margin = TRUE, data = OKCupid)
```

#### Example 3.1: Exploring Marginal Distributions

```{r}
SuperBowl <- read_csv("http://nhorton.people.amherst.edu/is5/data/Watch_the_Super_bowl.csv", skip = 1)
tally(~ Plan + Sex, data = SuperBowl)
```

#### Example 3.2: Exploring Percentages: Children and First-Class Ticket Holders First?

```{r}
Titanic <- read_csv("http://nhorton.people.amherst.edu/is5/data/Titanic.csv")
tally(~ Class + Survived, format = "percent", margin = TRUE, data = Titanic)
tally(~ Survived | Class, format = "percent", margin = TRUE, data = Titanic)
tally(~ Class | Survived, format = "percent", margin = TRUE, data = Titanic)
```

### Section 3.2: Conditional Distributions

See displays on 68-69.

```{r}
barplot(tally(~ CatsDogsBoth + Gender, data = OKCupid), beside = TRUE)
#There are many who don't own either
barplot(tally(~ CatsDogsBoth + Gender, data = filter(OKCupid, CatsDogsBoth != "NA")), beside = TRUE)
```

#### Example 3.3: Finding Conditional Distributions: Watching the Super Bowl

```{r}
tally(~ Plan + Sex, margin = TRUE, data = SuperBowl)
tally(~ Plan | Sex, format = "percent", data = SuperBowl)
```

#### Example 3.4: Looking for Associations Between Variables: Still Watching the Super Bowl

```{r}
barplot(tally(~ Plan | Sex, format = "percent", data = SuperBowl), beside = TRUE)
```

#### Examining Contingency Tables

```{r}
FishDiet <- read_csv("http://nhorton.people.amherst.edu/is5/data/Fish_diet.csv", skip = 1)
tally(~ `Diet:Counts` + `Cancer:Counts`, data = FishDiet)
```

#### Random Matters

```{r}
Nightmares <- read_csv("http://nhorton.people.amherst.edu/is5/data/Nightmares.csv", skip = 1)
Nightmares$Dream <- ifelse(Nightmares$Dream == "N", "Nightmare", "SweetDreams") 
#notation can be improved, but renaming seems necessary
tally(~ Side + Dream, data = Nightmares)
```

### Section 3.3: Displaying Contingency Tables

```{r}
tally(~ Class + Survived, format = "count", data = Titanic)
tally(~ Class + Survived, format = "percent", data = Titanic)
barplot(tally(~ Survived | Class, format = "percent", data = Titanic), beside = TRUE)
barplot(tally(~ Class | Survived, format = "percent", data = Titanic))
```

```{r}
vcd::mosaic(tally(~ Survived + Class, data = Titanic), 
           main = "Mosaic plot of Class by Survival",
           shade = TRUE)
```

#### Example 3.5: Looking for Associations in Large Data Sets: Text Messages

```{r}
# Not sure where the data is
```

#### Example 3.6: Looking for Associations in Large Data Sets: Text Messages Revisited

```{r}
# Same as above
```

### Section 3.4: Three Categorical Variables

```{r}
tally(~ Gender + CatsDogsBoth + `drugsY/N`, format = "percent", data = OKCupid)
```

#### Example 3.7: Looking for Associations Among Three Variables at Once

```{r}
vcd::mosaic(tally(~ Sex + Survived + Class, data = Titanic), shade = TRUE)
```

#### Example 3.8: Simpson's Paradox: Gender Discrimination?

```{r}
# Not sure where the data is
```
